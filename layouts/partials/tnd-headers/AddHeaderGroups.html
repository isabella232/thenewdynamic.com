{{ $headerGroups := slice }}
{{ $script_sources := slice `'self'` `'unsafe-eval'` `https://cdn.usefathom.com` `https://identity.netlify.com` }}
{{ $CSP := `
- default-src 'self';
- style-src 'self' 'unsafe-inline';
- prefetch-src https://thenewdynamic.imgix.net;
- object-src 'none';
- img-src 'self' https://thenewdynamic.imgix.net https://img3.usefathom.com;
- font-src 'self';
- base-uri 'none';
- connect-src 'self' https://cdn.usefathom.com;
  ` | transform.Unmarshal }}
{{ $asset_script_src := slice }}
{{ with partialCached "func/GetStyleAssets" . "GetStyleAssets" }}
  {{ with where . "type" "critical" }}
    {{ $styles := dict "target" "/*" }}
    {{ $headers := slice }}
    {{ range . }}
      {{ $script_sources = $script_sources | append (printf `'sha256-%s'` (sha256 .Content)) }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $CSP_default_src := printf `script-src %s;` (delimit $script_sources " ") }}
{{ $CSP = $CSP | append $CSP_default_src }}
{{ $CSP_header := dict "target" "/*" "headers" (slice (dict "field" "Content-Security-Policy" "value" $CSP)) }}
{{ return slice $CSP_header }}
