{{ $headerGroups := slice }}
{{ $style_srcs := slice `'self'` `'unsafe-inline'` }}
{{ $CSP := `
- default-src 'self';
- script-src 'self' 'unsafe-eval' https://cdn.usefathom.com https://identity.netlify.com https://unpkg.com;
- prefetch-src https://thenewdynamic.imgix.net;
- object-src 'none';
- img-src 'self' https://thenewdynamic.imgix.net https://img3.usefathom.com;
- font-src 'self';
- base-uri 'none';
- connect-src 'self' https://cdn.usefathom.com;
  ` | transform.Unmarshal }}
{{ $asset_script_src := slice }}
{{ with partialCached "func/GetStyleAssets" . "GetStyleAssets" }}
  {{/* Remove X from critical when we're ready to get back to this */}}
  {{ with where . "type" "criticalX" }}
    {{ $styles := dict "target" "/*" }}
    {{ $headers := slice }}
    {{ range . }}
      {{ $style_srcs = $style_srcs | append (printf `'sha256-%s'` (sha256 .Content)) }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $CSP_style_srcs := printf `style-src %s;` (delimit $style_srcs " ") }}
{{ $CSP = $CSP | append $CSP_style_srcs }}
{{ $CSP_header := dict "target" "/*" "headers" (slice (dict "field" "Content-Security-Policy" "value" $CSP)) }}
{{ return slice $CSP_header }}
