{{ $styles := partialCached "func/GetStyleAssets" . "GetStyleAssets" }}
{{ range where $styles "type" "==" "critical" }}
  {{ with .style }}
    <style>{{ .Content | safeCSS }}</style>
  {{ end }}
{{ end }}
{{ range where $styles "type" "!=" "critical" }}
  {{ with .style }}
    <link 
      rel="stylesheet" 
      href="{{ .RelPermalink }}"
      {{ with .Data.Integrity }}
      integrity="{{ . }}"
      {{ end }}
    >
  {{ end }}
{{ end }}
{{ range resources.Match "fonts/**/*.woff2" }}
<link rel="prefetch" href="{{ .RelPermalink }}" as="font" crossorigin>
{{ end }}

{{/* REGIS: You removed the below, I replaced. If it can be covered with the styles above that's fine, but fonts weren't working. */}}
{{ $font := resources.Get "fonts/index.css" }}
{{ with $font }}
  {{ $font := . | resources.Minify }}  
    <link rel="stylesheet" href="{{ $font.RelPermalink }}">
{{ end }}